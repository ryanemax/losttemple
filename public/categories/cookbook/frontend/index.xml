<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Cookbook/Frontend on 刘雨飏@ANAS联盟</title>
    <link>https://ryanemax.github.io/categories/cookbook/frontend/</link>
    <description>Recent content in Cookbook/Frontend on 刘雨飏@ANAS联盟</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <copyright>©2007-2016 Ryn&#39;s Blog</copyright>
    <lastBuildDate>Wed, 30 Mar 2016 15:05:51 +0800</lastBuildDate>
    <atom:link href="https://ryanemax.github.io/categories/cookbook/frontend/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>ionic2及ng2谷歌/高德地图控件分析实例</title>
      <link>https://ryanemax.github.io/cookbook/frontend/ionic2-googlemap-amap/</link>
      <pubDate>Wed, 30 Mar 2016 15:05:51 +0800</pubDate>
      
      <guid>https://ryanemax.github.io/cookbook/frontend/ionic2-googlemap-amap/</guid>
      <description>

&lt;h1 id=&#34;ionic2及ng2谷歌-高德地图控件分析实例:f65739047e30db9a825e1a5bb607abf7&#34;&gt;《ionic2及ng2谷歌/高德地图控件分析实例》&lt;/h1&gt;

&lt;h1 id=&#34;创建示例项目:f65739047e30db9a825e1a5bb607abf7&#34;&gt;创建示例项目&lt;/h1&gt;

&lt;p&gt;项目地址：&lt;a href=&#34;https://github.com/driftyco/ionic-conference-app&#34;&gt;https://github.com/driftyco/ionic-conference-app&lt;/a&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-sh&#34;&gt;git clone https://github.com/driftyco/ionic-conference-app
cd ionic-conference-app
npm install
ionic serve
&lt;/code&gt;&lt;/pre&gt;

&lt;h1 id=&#34;map-js解析:f65739047e30db9a825e1a5bb607abf7&#34;&gt;map.js解析&lt;/h1&gt;

&lt;h2 id=&#34;问题:f65739047e30db9a825e1a5bb607abf7&#34;&gt;问题&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;google.maps.Map包来自哪里，如何实现的？&lt;/li&gt;
&lt;li&gt;如何将map.js迁移至高德地图，以便国内用户使用？&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;代码展示:f65739047e30db9a825e1a5bb607abf7&#34;&gt;代码展示&lt;/h2&gt;

&lt;pre&gt;&lt;code class=&#34;language-js&#34;&gt;// 文件 project/app/pages/map/map.js
onPageLoaded() {
  this.confData.getMap().then(mapData =&amp;gt; {
    let mapEle = document.getElementById(&#39;map&#39;);

    let map = new google.maps.Map(mapEle, {
      center: mapData.find(d =&amp;gt; d.center),
      zoom: 16
    });

    mapData.forEach(markerData =&amp;gt; {
      let infoWindow = new google.maps.InfoWindow({
        content: `&amp;lt;h5&amp;gt;${markerData.name}&amp;lt;/h5&amp;gt;`
      });

      let marker = new google.maps.Marker({
        position: markerData,
        map: map,
        title: markerData.name
      });

      marker.addListener(&#39;click&#39;, () =&amp;gt; {
        infoWindow.open(map, marker);
      });
    });

    google.maps.event.addListenerOnce(map, &#39;idle&#39;, () =&amp;gt; {
      mapEle.classList.add(&#39;show-map&#39;);
    });

  });
}
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;探索:f65739047e30db9a825e1a5bb607abf7&#34;&gt;探索&lt;/h2&gt;

&lt;h3 id=&#34;寻找google地图插件:f65739047e30db9a825e1a5bb607abf7&#34;&gt;寻找google地图插件&lt;/h3&gt;

&lt;ol&gt;
&lt;li&gt;查找整个项目，但发现不存在任何googlet地图包引入相关的代码&lt;/li&gt;
&lt;/ol&gt;

&lt;pre&gt;&lt;code class=&#34;language-sh&#34;&gt;  cd project/app
  grep -rn &amp;quot;map&amp;quot;
&lt;/code&gt;&lt;/pre&gt;

&lt;ol&gt;
&lt;li&gt;&lt;p&gt;查找看webpack.config.js，不存在任何google地图包引入&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;是否angular2中自带google地图包&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;参考：&lt;a href=&#34;https://angular.io/docs/js/latest&#34;&gt;https://angular.io/docs/js/latest&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;不存在&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;是否ionic2自带google地图包&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;参考：&lt;a href=&#34;http://ionicframework.com/docs/v2/&#34;&gt;http://ionicframework.com/docs/v2/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;不存在&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;index.html中引入了googlemaps的api&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;pre&gt;&lt;code class=&#34;language-html&#34;&gt;  &amp;lt;!-- google maps script is loaded last as to not block rendering --&amp;gt;
  &amp;lt;script src=&amp;quot;//maps.googleapis.com/maps/api/js?sensor=false&amp;quot;&amp;gt;&amp;lt;/script&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;注释掉script引入，测试是否影响程序运行，报错&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-js&#34;&gt;  EXCEPTION: ReferenceError: google is not defined app.bundle.js:34204
  EXCEPTION: ReferenceError: google is not defined
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;注释后报错，确认google地图插件来自于index页面script的引入&lt;/p&gt;

&lt;h2 id=&#34;实践-更换地图控件为高德地图:f65739047e30db9a825e1a5bb607abf7&#34;&gt;实践——更换地图控件为高德地图&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;参考地址：&lt;a href=&#34;http://lbs.amap.com/api/javascript-api/guide/quickstart/&#34;&gt;http://lbs.amap.com/api/javascript-api/guide/quickstart/&lt;/a&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;key申请：注册成为高德开发者，申请appkey&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;在index.html添加高德api引入代码&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;pre&gt;&lt;code class=&#34;language-html&#34;&gt;  &amp;lt;script type=&amp;quot;text/javascript&amp;quot; src=&amp;quot;http://webapi.amap.com/maps?v=1.3&amp;amp;key=您申请的key值&amp;quot;&amp;gt;&amp;lt;/script&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;ol&gt;
&lt;li&gt;参考高德快速入门，重写map.js的OnPageLoaded部分代码&lt;/li&gt;
&lt;/ol&gt;

&lt;pre&gt;&lt;code class=&#34;language-js&#34;&gt;  onPageLoaded() {
  this.confData.getMap().then(mapData =&amp;gt; {
    let mapEle = document.getElementById(&#39;map&#39;);

    let map = new AMap.Map(&#39;map&#39;, {
      center: mapData.find(d =&amp;gt; d.center),
      zoom: 16
    });
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;报错&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-js&#34;&gt;  EXCEPTION: TypeError: this.ib(...) is undefined
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;原因：mapData.find()函数中经纬度格式不正确&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;修改正确的OnPageLoaded代码&lt;/li&gt;
&lt;/ol&gt;

&lt;pre&gt;&lt;code class=&#34;language-js&#34;&gt;  let mapEle = document.getElementById(&#39;map&#39;);

  let cdata = mapData.find(d =&amp;gt; d.center);

  let map = new AMap.Map(mapEle, {
   center: [cdata.lng,cdata.lat],
   zoom: 16
  });

&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;报错，但不影响使用&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-js&#34;&gt;  Firefox can t establish a connection to the server at ws://vdata.amap.com/. maps:1:28148

  The connection to ws://vdata.amap.com/ was interrupted while the page was loading.
&lt;/code&gt;&lt;/pre&gt;

&lt;ol&gt;
&lt;li&gt;Console不报错但是无法显示？CSS样式问题！&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;注释掉两行调整透明度的样式即可成功&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-css&#34;&gt;  .map-page #map {
  width: 100%;
  height: 100%;
  //opacity: 0;
  //transition: opacity 150ms ease-in
  }
&lt;/code&gt;&lt;/pre&gt;

&lt;ol&gt;
&lt;li&gt;继续修复marker和info控件&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&#34;实践成果-附上完美整合高德地图后map-js的onpageloaded-函数:f65739047e30db9a825e1a5bb607abf7&#34;&gt;实践成果——附上完美整合高德地图后map.js的OnPageLoaded()函数&lt;/h2&gt;

&lt;pre&gt;&lt;code class=&#34;language-js&#34;&gt;onPageLoaded() {
  this.confData.getMap().then(mapData =&amp;gt; {
    let mapEle = document.getElementById(&#39;map&#39;);

    let cdata = mapData.find(d =&amp;gt; d.center);
    let map = new AMap.Map(mapEle, {
      center: [cdata.lng,cdata.lat],
      zoom: 16
    });

    mapData.forEach(markerData =&amp;gt; {
            let infoWindow = new AMap.InfoWindow({
                    content: `&amp;lt;h1&amp;gt;标记位置:&amp;lt;/h1&amp;gt;&amp;lt;p&amp;gt;${markerData.name}。&amp;lt;/p&amp;gt;`,
                    offset: new AMap.Pixel(0, -30),
                    size:new AMap.Size(230,0)
            });

            let marker = new AMap.Marker({
                    position: [markerData.lng,markerData.lat],
                    map: map,
                    title: markerData.name
            });

            let clickHandle = AMap.event.addListener(marker,&#39;click&#39;, () =&amp;gt; {
                    infoWindow.open(map, marker.getPosition());
            });
    });

    AMap.event.addListenerOnce(map, &#39;idle&#39;, () =&amp;gt; {
            mapEle.classList.add(&#39;show-map&#39;);
    });
  });
&lt;/code&gt;&lt;/pre&gt;
</description>
    </item>
    
  </channel>
</rss>